# Библиотека _treport_

## Назначение бибилиотеки

Библиотекат _treport_ предназначена для формирования отчетов, имеющих исключительно табличное представление 
и фиксированное количество колонок. Результат формирования отчета выводится в формате _MS Excel_.

## Использование библиотеки

### Подготовительные мероприятия

Перед использованием библиотеки необходимо создать рабочий каталог, где будут размещаться файлы с SQL-запросами
к базе данных, шаблоны отчетных форм, описание параметров формирования отчетов, описание параметров подключения
к базе данных.

В данном проекте присутствует пример такого каталога- _treport_example_. Внутри данного каталога находятся следующие файлы:

- _run_report.xml_- декларативное описание параметров формирования отчетных форм;
- _run_report.ini_ - ini-файл, в котором прописаны параметры подклбчения к базе данных и путь к файлу _run_report.xml_
- _run_report.py_ - программа на языке программирования _Python_, демонстрирующая использование библиотеки.

Внутри каталога _treport_example_ так же были созданы следующие каталоги:

- _sql_ - каталог для хранения файлов с SQL-запросами, которые формируют контент отчета;
- _templates_ - каталог для хранения файлов шаблонов отчетных форм;
- _out_ - каталог для хранения файлов сформированных отчетов.

Для демонстрации работы бибилиотеки необходимо чтобы был установлен _PostgreSQL_ и создана таблица _documents_.

~~~sql
-- treport.documents definition

-- Drop table

-- DROP TABLE treport.documents;

CREATE TABLE treport.documents (
	id int8 NOT NULL GENERATED ALWAYS AS IDENTITY,
	docnum varchar NOT NULL,
	docdate date NOT NULL,
	docsum numeric NOT NULL,
	docsum2 numeric NOT NULL
);
~~~
Содержимое таблицы представлено в файле _documents.csv_. Для импорта данных из CSV-файла необходимо выполнить команду

~~~sql
copy treport.documents(docnum, docdate, docsum, docsum2) from '/path/to/documents.csv' delimiter ';' csv header;
~~~

### Декларативное описание отчета

Отчет состоит из двух основных частей- SQL-запроса к базе данных и шаблона, описывающего внешний вид отчета.

Для того чтобы библиотека поняла какие параметры допустимы для формирования отчета, какой шаблон использовать
для формирования отчета, какой SQL-запрос является источником данных для страницы отчета и т.д. необходимо 
описать характеристики отчетов, которые требуется сформировать.

Характеристики отчета описываются в файле в формате XML.

#### Элемент "reports"

Внутри элемента размещается описание каждого из отчетов.

#### Элемент "reports/report"

Является контейнером, внутри данного элемента размещается описание отчетной формы.

Иммется обязательный для заполнения атрибут _codeReport_. В атрибуте хранится значение кода отчета.

#### Элемент "reports/report/nameReport"

Обязательый для заполнения, указывается наименование отчета на русском языке.

#### Элемент "reports/report/template"

Обязательный для заполнения, указывается путь на файловой системе к шаблону отчета в формате MS Excel. Путь
может быть указан как абсолютный путь к файлу или как относительный от того места на файловой системе, где размещается
скрипт, вызывающий бибилиотеку.

#### Элемент "reports/report/outDir"

Обязательный для заполнения, указывается путь на файловой системе к каталогу в который необходимо сохранить
сформированный файл отчета. Путь может быть указан как абсолютный путь к файлу или как относительный от 
того места на файловой системе, где размещается скрипт, вызывающий бибилиотеку.

#### Элемент "reports/report/fileNameGenerateRule"

Элемент-контейнер. Внутри данного элемента размещаются элементы, описывающие правила формирования имени файла.
Правило описывается путем добавления элемента _segment_.

Каждый элемент _segment_ имеет обязательный для заполнения атрибут _segmentType_. В данной атрибуте указывается
тип сегмента имени файла. Допустимы следующие значения:

- _segmentString_ - произвольная строка;
- _parametr_ - подставляется значение параметра формируемого отчета;
- _function_ - указывается имя функции, которая вычисляет значение.

Используемые функции:

- now - вычислияет текущую дату/время. В скобках указывается аргумент функции. Тип значения аргумента- строка.
Указывается формат вывода даты/времени. Синтаксис приведен по адресу https://docs.python.org/3/library/datetime.html#strftime-strptime-behavior

#### Элемент "reports/report/params"

#### Элемент "reports/report/params/parametr"

#### Элемент "reports/report/params/parametr/parametrName"

#### Элемент "reports/report/params/parametr/parametrType"

#### Элемент "reports/report/params/parametr/parametrRequired"

